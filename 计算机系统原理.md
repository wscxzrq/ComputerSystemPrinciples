# 计算机系统原理

# 第一章 计算机系统概述

## 1.1 计算机基本工作原理

### 1.1.1 冯·诺依曼结构基本思想

**冯·诺伊曼结构** (von Neumann architecture) 是现代计算机设计的基础理念之一，由数学家和物理学家约翰冯·诺伊曼(Joho von Neumann) 提出。其基本思想包含以下几个主要方面：

**存储程序概念：**程序和数据以相同的方式存储在同一存储器中。这意味着计算机可以灵活地读写程序指令和数据，不需要装用的硬件单元分别处理编程和数据操作

分为五大部分：

**控制单元**(Control Unit)：负责解释并执行存储在存储器中的指令

**运算单元**(Arithmetic Logic Unit, ALU)：执行基本的算数和逻辑运算

**存储器**(Memory)：存储程序指令和数据

**输入设备**(input Device)：用于接收外部数据

**输出设备****(Output Device)：用于输出计算结果

**顺序执行**：程序指令按照其在存储器中的顺序逐条执行，除非遇到控制转移指令（入条件跳转指令），这使得程序的流程较为简单和直观

**二进制运算**：使用二进制数据表示所有数据和指令，这简化了物理实现，因为物理电路可以很容易地表示和处理二进制数据（如高/低电压或开/关状态）

**统一存储**：在冯·诺伊曼结构中，存储器中的所有位置都是平等的，没有本质上的区别（如没有程序存储专用区和数据存储专用区之分），这增加了计算机操作的灵活性

这些思想不进影响了最早期的计算机设计，还在今天的大多数计算机系统中得到了继续应用。这种结构使得计算机可以灵活地执行复杂程序、处理不同类型的数据、以及高效地完成各种任务

**冯·诺依曼结构主要部件**

1. 用来存放指令和数据的主存储器，简称**主存或内存**
1. 用来进行算数逻辑运算的部件    ，即**算数逻辑部件**（Arithmetic Logic Unit, ALU），在 `ALU`操作控制信号 `ALUop`的控制下，`ALU`可以对输入端 A 和 B 进行不同的运算，得到结果 F；
1. 用于自动逐条取出指令并进行编译的部件，即`控制元件`（Control Unit,CU），也称控制器
1. 用来和用户交互的**输入设备和输出设备** 

**冯·诺依曼结构相关的寄存器**

- 为了临时存放从主存取来的数据或运算的结果，还需要若干**通用寄存器**（Gemeral Purpose Gegiter）组成`通用寄存器组`（GPRs）,`ALU`两个输入端 A 和 B 的数据来自通用寄存器
- ALU 运算的结果会产生标志信息，例如，结果是否为 0（零标志 ZF）、是否为负数（符号标志 SF）等，这些标志信息需要记录在专门的`标志寄存器`中
- 从主存取来的指令需要临时保存在**指令寄存器**(Instruction Register,IR)中
- `CPU `为了自动按序读取主存中的指令，还需要有一个**程序计数器**（Program Counter,PC）,在执行当前指令的过程中，自动计算出下一条指令的地址并送到 PC 中保存。通常把控制部件、运算部件和各类寄存器互连组成的电路称为**中央处理器**(Central Processing Unit, CPU)，简称`处理器`

**冯·诺依曼通用寄存器编号**

CPU 需要从通用寄存器中取数据到 `ALU`运算，或把 `ALU`运算的结果保存到通用寄存器中，因此，需要给每个通用寄存器编号。同样，主存中每个单元也需要编号，称为**主存单元地址**，简称**主存地址**。通用寄存器和主存都属于存储部件，计算机中的存储部件都从 0 开始编号

**冯·诺依曼中的总线**

CUP 为了从主存取指令和存取数据，需要通过传输介质和主存相连，通常把连接不同部件进行信息传输的介质称为**总线**，其中，包含了用于传输`地址信息`、`数据信息`和`控制信息`的`地址线`、`数据线`和`控制线`。CPU 访问主存时，需先将主存地址、读/写命令分别送到总线的地址线、控制线和数据线，然后通过数据线发送或接收数据。CPU 送到地址线的主存地址应先存放在**主存地址存储器**（Memory Address register,MAR）中，发送到或从数据线取来的信息存放在**主存数据寄存器**（MemoryData Register，MDR）中

**冯·诺依曼硬件结构图**

![image-20240603231837772](image-20240603231837772.png)

### 1.1.2 程序和指令的执行过程

`程序`是由一系列`有序`的`指令`组成，用于让计算机执行特定任务或解决特定问题的`集合`。这些指令是用特定的编程语言编写的。程序通常包括`输入`、`处理`和`输出`三个部分。通过将这些指令按照逻辑顺序组织起来，程序可以完成从简单的算数运算到复杂的数据处理和用户交互等各种任务。

**程序的关键特点**：

1. **有序性：**所有指令按照特定顺序执行
1. **确定性：**相同的输入在相同条件下会产生相同的输出
1. **可以移植性：**很多程序可以在多个系统上运行，前提是有先赢的编译器或解释器支持

`指令`是一个单独的命令，指示计算机执行一个特定的操作。指令可以是低级的机器代码，也可以是高级编程语言中的单个语句。在低级编程中，指令通常是二进制格式的，在高级编程语言中，指令则是类似于自然语言的代码行

**指令的关键特点**：

1. **原子性：**每条指令通常代表一个原子的操作或步骤
1. **执行性：**指令是由计算机处理单元直接执行的操作

**程序与指令的区别与联系**

|              程序              |                   指令                   |
| :----------------------------: | :--------------------------------------: |
|         由多个指令组成         |              单个命令或操作              |
|          高级组织形式          |                 基本单位                 |
|        用于完成复杂任务        |          用于执行具体的基本操作          |
|       提现整体逻辑和功能       |         提现具体的运算和操作步骤         |
| 例如：一个计算两个数相加的程序 | 例如：将值从一个寄存器加载到另一个寄存器 |

**冯·诺依曼**结构计算机的功能通过执行程序实现，程序的执行过程就是包含的指令的执行过程。

**指令**（instruction）是用0和 1 表示的一串0/1序列，用来指示 `CPU`完成一个特定的原子操作，例如，

- **取数指令**（load）从`主存`单元中取出数据存放到`通用寄存器`中
- **存数指令**（store）将`通用寄存器`的内容写入`主存单元`
- **加法指令**（add）将两个`通用寄存器`内容相加后送入`结果寄存器`
- **传送指令**（mov）将一个`通用寄存器`的内容送到另一个`通用寄存器`

**定长指令格式**

该模型机采用 8 位定长指令字，即每条指令有 8 位，因此指令寄存器 IR 的宽度为 8 位。指令格式有R 型和 M 型两种

![image-20240603235502817](image-20240603235502817.png)

`op`为操作码字段，`R` 型指令的 `op` 为0000、0001 时，分别定义为寄存器间`传送(mov)`和`加(add)`操作；`M `型指令的 `op `为`1110`和` 1111`，分别定义为`取数(load)`和`存数(store)`，`rs` 和` rt`为通用寄存器编号，`addr`为主存单元地址

R[r]表示编号为 r 的通用寄存器中的内容，M[addr]表示地址为 addr 的主存单元内容，$\leftarrow$表示从右向左传送数据。

指令 1110 0110的功能为 R[0] $\leftarrow$ M[0110] 表示将 6 号主存单元（地址为0110）中的内容取到 0 号寄存器；指令 0001 0001 的功能为 R[0] $\leftarrow$ R[0] + R[1],表示将0 号和 1 号寄存器内容相加的结果送到 0 号寄存器

![image-20240604003648467](image-20240604003648467.png)













































# 第二章 数据的表示和运算

# 第三章 程序的转换及机器级表示

# 第四章 可执行文件的生成与加载执行

# 第五章 程序的存储访问

# 第六章 程序中的 I/O 操作实现
